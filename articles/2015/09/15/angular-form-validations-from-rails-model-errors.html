<!DOCTYPE html><html ng-app="kagd"><head><script src="https://use.typekit.net/ola6uac.js"></script><script>try{Typekit.load({ async: true });}catch(e){}</script><meta charset="utf-8" /><meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><title>Grant Klinsing  - Angular Form Validations from Rails Model Errors</title><link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/articles/feed.xml" /><link href="/stylesheets/application-6f31c7ce.css" rel="stylesheet" /><link href="/stylesheets/syntax_highlighter/monokai-087b6249.css" rel="stylesheet" /><link href="/images/favicon.ico" rel="icon" type="image/ico" /><script>window.env = {
  API_HOST: '/'
}</script><script src="/javascripts/vendor-27cf58e5.js"></script></head><body class="articles articles_2015 articles_2015_09 articles_2015_09_15 articles_2015_09_15_angular-form-validations-from-rails-model-errors" menu-classes=""><div class="grid-frame"><div class="grid-block vertical"><div class="grid-block shrink"><header class="title-bar dark"><div class="title left"><a class="brand" href="/"><img alt="Grant Klinsing" src="/images/logo-a84e8d17.svg" /></a></div><div class="right"><nav><ul><li class="menu"><a menu-button=""><span>Menu</span><div class="bars"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div></a></li><li class="articles"><a href="/posts.html"><i class="fa fa-book"></i><span>/ Articles</span></a></li><li class="github"><a href="http://github.com/kagd" target="_blank"><i class="fa fa-github"></i><span>/ kagd</span></a></li><li class="twitter"><a href="http://twitter.com/gklinsing" target="_blank"><i class="fa fa-twitter"></i><span>/ @gklinsing</span></a></li><li class="stack-overflow"><a href="http://careers.stackoverflow.com/gklinsing" target="_blank"><i class="fa fa-stack-overflow"></i><span>/ gklinsing</span></a></li><li class="linked-in"><a href="https://www.linkedin.com/in/grantklinsing" target="_blank"><i class="fa fa-linkedin"></i><span>/ grantklinsing</span></a></li></ul></nav></div></header></div><section class="grid-block" id="main" role="main"><div class="grid-block align-center"><div class="grid-content large-8 article-content"><div class="article-header"><a class="tag" href="/articles/tags/angular.html"><img src="/images/angular-11984bea.svg" /></a><h1>Angular Form Validations from Rails Model Errors</h1><div class="date"> <span>2015 /</span>  <span>September 15</span> </div></div><div class="article-body"><p>I love Rails for it&rsquo;s baked in model validations. I love Angular for the simplicity.
Together, you can keep your data validations on the server and update the angular
forms with something that is familiar to Rails devs, convention over configuration.</p>

<p></p>

<p>First, let&rsquo;s start with the Rails model.</p>

<pre><code class="prettyprint lang-ruby">class InventoryItem &lt; ActiveRecord::Base
  validates :price, presence: true
end
</code></pre>

<p>We have a <code class="prettyprint">InventoryItem</code> model that has a validation for presence. Since you are
familiar with Rails validations, you know that if try to save your flight without
a price you will get an error that looks like this:</p>

<pre><code class="prettyprint lang-ruby">inventory_item = InventoryItem.new
inventory_item.valid? #=&gt; false
inventory_item.errors.messages #=&gt;  {:price=&gt;[&quot;can&#39;t be blank&quot;]}
</code></pre>

<p>We just have to pass the error hash back to the UI as json.</p>

<pre><code class="prettyprint lang-ruby">class InventoryItemController &lt; ApplicationController
  def create
    @inventory_item = InventoryItem.new params_for_create

    if @inventory_item.save
      # return the item
      render json: @inventory_item
    else
      # Return the inventory_item errors
      render json: { errors: @inventory_item.errors.messages }, status: :conflict
    end
  end

  private #-------------------------

  def params_for_create
    params[:inventory_item]
    params.required(:inventory_item).permit(:price)
  end
end
</code></pre>

<p>Now let&rsquo;s create the Angular controller and view that will handle the error
response.</p>

<pre><code class="prettyprint lang-coffee">angular.module(&#39;myApp&#39;, [&#39;error-helpers&#39;]) # error-helpers will be defined in just a bit

# Define controller
InventoryItemController = ($http, ErrorHelpers)-&gt;
  ctrl = @
  # bind the methods from ErrorHelpers.setupErrorHelpers to this controller
  ErrorHelpers.setupErrorHelpers.call(ctrl)
  # Setup new model
  ctrl.inventoryItem = {
    price: null
  }

  ctrl.onSubmit = -&gt;
    # clear any errors that were set on a previous submit
    ctrl.clearErrors()

    $http.post &#39;/api/inventory_items&#39;, ctrl.inventoryItem
      .then (response) -&gt;
        # do whatever you need to
      .catch (response) -&gt;
        # populate the errors object
        ctrl.populateErrors(response.data.errors)

angular.module(&#39;myApp&#39;).controller &#39;InventoryItemController&#39;, InventoryItemController
InventoryItemController.$inject = [&#39;$http&#39;, &#39;ErrorHelpers&#39;]

# Define ErrorHelpers
ErrorHelpers = -&gt;
  helper = @
  helper.setupErrorHelpers = -&gt;
    binding = @
    binding.errors = {}

    binding.populateErrors = (errors) -&gt;
      for own key, value of errors
        binding.errors[key] = value

    binding.clearErrors = -&gt;
      for own key, value of binding.errors
        delete binding.errors[key]

  return helper

angular.module(&#39;error-helpers&#39;, [])
  .service &#39;ErrorHelpers&#39;, ErrorHelpers

</code></pre>

<p>For the HTML I will just use some Bootstrap markup:</p>

<pre><code class="prettyprint lang-html">&lt;form ng-submit=&quot;itemCtrl.onSubmit()&quot; ng-controller=&quot;InventoryItemController as itemCtrl&quot;&gt;
  &lt;!--
    when itemCtrl.errors.price is present add &#39;has-class&#39; to .form-group
  --&gt;
  &lt;div class=&quot;form-group&quot; ng-class=&quot;{ &#39;has-error&#39;: itemCtrl.errors.price }&quot;&gt;
    &lt;label for=&quot;price&quot;&gt;Item Price&lt;/label&gt;
    &lt;input type=&quot;text&quot; id=&quot;price&quot; ng-model=&quot;itemCtrl.inventoryItem.price&quot;&gt;
    &lt;!--
      when itemCtrl.errors.price is present display .help-block
    --&gt;
    &lt;p class=&quot;help-block&quot; ng-if=&quot;itemCtrl.errors.price&quot;&gt;{{ itemCtrl.errors.price.join(&#39;, &#39;) }}&lt;/p&gt;
  &lt;/div&gt;
&lt;/form&gt;
</code></pre>

<p>This could definitely use a directive but rather than abstract it for this example,
I chose simplicity.</p>

<p>This will interpolate your Rails model errors when they are returned from the server
and apply the Bootstrap <code class="prettyprint">has-error</code> class to the markup to highlight the error.</p>
<div id="disqus_thread"></div><script>/* * * CONFIGURATION VARIABLES * * */
var disqus_shortname = 'kagdgithubio';
var disqus_identifier = 'angular-form-validations-from-rails-model-errors';
var disqus_title = 'Angular Form Validations from Rails Model Errors';
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div></div></section></div></div><div class="mobile-menu"><ul><li class="articles"><a href="/posts.html"><i class="fa fa-book"></i><span>/ Articles</span></a></li><li class="github"><a href="http://github.com/kagd" target="_blank"><i class="fa fa-github"></i><span>/ kagd</span></a></li><li class="twitter"><a href="http://twitter.com/gklinsing" target="_blank"><i class="fa fa-twitter"></i><span>/ @gklinsing</span></a></li><li class="stack-overflow"><a href="http://careers.stackoverflow.com/gklinsing" target="_blank"><i class="fa fa-stack-overflow"></i><span>/ gklinsing</span></a></li><li class="linked-in"><a href="https://www.linkedin.com/in/grantklinsing" target="_blank"><i class="fa fa-linkedin"></i><span>/ grantklinsing</span></a></li></ul></div><script src="/javascripts/application-a87a6ca3.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-67203020-1', 'auto');
ga('send', 'pageview');</script></body></html>