<!DOCTYPE html><html ng-app="kagd"><head><script src="https://use.typekit.net/ola6uac.js"></script><script>try{Typekit.load({ async: true });}catch(e){}</script><meta charset="utf-8" /><meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><title>Grant R. Klinsing  - Angular Services Without Promises</title><link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/articles/feed.xml" /><link href="/stylesheets/application.css" rel="stylesheet" /><link href="/stylesheets/syntax_highlighter/monokai.css" rel="stylesheet" /><link href="/images/favicon.ico" rel="icon" type="image/ico" /><script src="/javascripts/vendor.js"></script></head><body class="articles articles_2015 articles_2015_08 articles_2015_08_27 articles_2015_08_27_angular-services-without-promises" menu-classes=""><div class="grid-frame"><div class="grid-block vertical"><div class="grid-block shrink"><header class="title-bar dark"><div class="title left"><a class="brand" href="/"><img alt="Grant Klinsing" src="/images/logo.svg" /></a></div><div class="right"><nav><ul><li class="menu"><a menu-button=""><span>Menu</span><div class="bars"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div></a></li><li class="articles"><a href="/posts.html"><i class="fa fa-book"></i><span>/ Articles</span></a></li><li class="github"><a href="http://github.com/kagd" target="_blank"><i class="fa fa-github"></i><span>/ kagd</span></a></li><li class="twitter"><a href="http://twitter.com/gklinsing" target="_blank"><i class="fa fa-twitter"></i><span>/ @gklinsing</span></a></li><li class="stack-overflow"><a href="http://careers.stackoverflow.com/gklinsing" target="_blank"><i class="fa fa-stack-overflow"></i><span>/ gklinsing</span></a></li><li class="linked-in"><a href="https://www.linkedin.com/in/grantklinsing" target="_blank"><i class="fa fa-linkedin"></i><span>/ grantklinsing</span></a></li></ul></nav></div></header></div><section class="grid-block" id="main" role="main"><div class="grid-block align-center"><div class="grid-content large-8 article-content"><div class="article-header"><a class="tag" href="/articles/tags/angular.html"><img src="/images/angular.svg" /></a><h1>Angular Services Without Promises</h1><div class="date"> <span>2015 /</span>  <span>August 27</span> </div></div><div class="article-body"><p>Services in Angular.js are a great tool for abstraction and re-use. They pull a resource
from the server via a promise and then your code handles the resolve. The problem here
is that all controllers, directives or whatever that handles the promise has to be setup
to assign the data on resolve.</p>

<p>But wouldn&rsquo;t it be great to have your service return the data inline without having
to handle the promise each time? While maintaining the asynchronous nature of services?</p>

<p></p>

<p>This can be accomplish with a combination of an Angular service and a Javascript schema generator
called <a href="https://github.com/autoric/scheming">Scheming</a>.</p>

<p>Let&rsquo;s assume we have an order service that retrieves an order by ID.</p>

<pre><code class="prettyprint lang-coffee">OrdersService = ($http) -&gt;
  @get = (id) -&gt;
    $http.get &quot;api/orders/#{ id }&quot;

  return @

angular.module(&#39;myApp&#39;)
  .service &#39;OrdersService&#39;, OrdersService

OrdersService.$inject = [&#39;$http&#39;]
</code></pre>

<p>Nothing out of the ordinary here. This is using promises to retrieve the data and we will
have to handle the resolve it in our controller. So let&rsquo;s change it so the service
returns a data object and still pulls the requested resource.</p>

<p>First, we create a Scheming <code class="prettyprint">Order</code> model:</p>

<pre><code class="prettyprint lang-coffee">Order = ($window) -&gt;
  scheming = $window.Scheming

  scheming.create
    id: scheming.TYPES.Integer
    createdAt: scheming.TYPES.Date
    complete: scheming.TYPES.Boolean

angular.module(&#39;myApp&#39;).factory &#39;Order&#39;, Order

Order.$inject = [&#39;$window&#39;]
</code></pre>

<p>This model should have all the fields that you need to represent in the view.</p>

<p>Next, we need to update our service to use the <code class="prettyprint">Order</code> model:</p>

<pre><code class="prettyprint lang-coffee">OrdersService = ($http, Order) -&gt;
  populateModelFromResponse = (model, data) -&gt;
    data.forEach (value, key) -&gt;
      model[key] = value

  @get = (id) -&gt;
    order = new Order()
    $http.get &quot;api/orders/#{ id }&quot;
      .then (response) -&gt;
        populateModelFromResponse(order, response.data)

    return order

  return @

angular.module(&#39;myApp&#39;)
  .service &#39;OrdersService&#39;, OrdersService

OrdersService.$inject = [&#39;$http&#39;, &#39;Order&#39;]
</code></pre>

<p>Let&rsquo;s go over the <code class="prettyprint">get</code> method first. Instead of returning a promise, we are now
returning a new instance of <code class="prettyprint">Order</code>. That means that controller doesn&rsquo;t need to
handle the response because it will already have an object. Just an empty one.</p>

<p>Now, since an object was returned in the service, any views interpolating a
property of the <code class="prettyprint">Order</code> model will be automatically updated. This does mean that
there may be a delay between when the call is made and when the model is populated.
So there may be empty view since the data doesn&rsquo;t exist until there is a response.</p>

<p>I suppose <code class="prettyprint">populateModelFromResponse</code> should be moved into it&rsquo;s own helper to be used
in all the other services as well. But I will let you figure that one out.</p>

<p>If you are wondering how to make this call in your controllers, you can simply do
this:</p>

<pre><code class="prettyprint lang-coffee">@order = OrdersService.get(123)
</code></pre>

<p>rather than this:</p>

<pre><code class="prettyprint lang-coffee">ctrl = @
ctrl.order = {}

OrdersService.get(123).then (response) -&gt;
  ctrl.order = response.data
</code></pre>

<p>After all this you are probably thinking, &ldquo;I don&rsquo;t need to use Scheming at all. I
can just use pojo (plain old Javascript objects).&rdquo; And, you are correct. What Scheming
get&rsquo;s you is a great way to validate a model on the client side. :)</p>
<div id="disqus_thread"></div><script>/* * * CONFIGURATION VARIABLES * * */
var disqus_shortname = 'kagdgithubio';
var disqus_identifier = 'angular-services-without-promises';
var disqus_title = 'Angular Services Without Promises';
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div></div></section></div></div><div class="mobile-menu"><ul><li class="articles"><a href="/posts.html"><i class="fa fa-book"></i><span>/ Articles</span></a></li><li class="github"><a href="http://github.com/kagd" target="_blank"><i class="fa fa-github"></i><span>/ kagd</span></a></li><li class="twitter"><a href="http://twitter.com/gklinsing" target="_blank"><i class="fa fa-twitter"></i><span>/ @gklinsing</span></a></li><li class="stack-overflow"><a href="http://careers.stackoverflow.com/gklinsing" target="_blank"><i class="fa fa-stack-overflow"></i><span>/ gklinsing</span></a></li><li class="linked-in"><a href="https://www.linkedin.com/in/grantklinsing" target="_blank"><i class="fa fa-linkedin"></i><span>/ grantklinsing</span></a></li></ul></div><script src="/javascripts/application.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-67203020-1', 'auto');
ga('send', 'pageview');</script></body></html>